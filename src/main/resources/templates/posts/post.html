<!doctype html><html th:replace="~{layout/base :: base(~{fragments/headerItems :: postList}, ~{::div})}" xmlns:th="http://www.thymeleaf.org">

<div class="container">
    <div class="d-flex justify-content-center">
        <button class="btn btn-primary align-self-center" th:text="${post.category.categoryName}">업종</button>
    </div><br>

    <div class="d-flex justify-content-center">
        <h5 th:text="${post.title}">제목</h5>
    </div><br>

    <div class="row">
        <p class="col-4 text-start" th:text="${#temporals.format(post.timestamp, 'yyyy년 MM월 dd일 HH:mm')}">작성일시</p>
        <p class="col-4 text-center" th:text="${post.writer.nickname}">닉네임</p>
        <p class="col-4 text-end">남은 수량 : [[${post.quantity}]]</p>
    </div><br>

    <div class="d-flex justify-content-center">
        <ul class="list-group list-group-horizontal">
<!--                <div th:each="image : ${post.images}">-->
<!--                    <li class="list-group-item"><img th:src="@{/images/{img}(img=${image.storedFilename})}" style="width: 300px; height: 300px; border: 2px solid red" /></li>-->
<!--                </div>-->
        </ul>
    </div><br><br>

    <h4 class="d-flex justify-content-center">내용</h4>
    <div class="d-flex justify-content-center">
        <div th:text="${post.content}" style="width: 750px; border: 2px solid yellow;">
            내용
        </div>
    </div><br><br>

    <h4 class="d-flex justify-content-center">위치</h4>
    <p class="d-flex justify-content-center text-center" th:text="|${post.address.doro}|">주소</p>

    <div class="d-flex justify-content-center">
        <div id="map" style="width: 600px; height: 500px; border: 2px solid green"></div>
        <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=f1ad9b5adce2cf7e772b667dde656195&libraries=services"></script>
        <script th:inline="javascript">
        /*<![CDATA[*/
            var mapContainer = document.getElementById('map'), // 지도를 표시할 div
            mapOption = {
                center: new kakao.maps.LatLng(33.450701, 126.570667), // 지도의 중심좌표
                level: 3 // 지도의 확대 레벨
            };

            // 지도를 생성합니다
            var map = new kakao.maps.Map(mapContainer, mapOption);

            // 주소-좌표 변환 객체를 생성합니다
            var geocoder = new kakao.maps.services.Geocoder();

            // 주소로 좌표를 검색합니다
            geocoder.addressSearch(/*[[${post.address.doro}]]*/, function(result, status) {

                // 정상적으로 검색이 완료됐으면
                 if (status === kakao.maps.services.Status.OK) {

                    var coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                    var Y = result[0].y;
                    var X = result[0].x;

                    // 결과값으로 받은 위치를 마커로 표시합니다
                    var marker = new kakao.maps.Marker({
                        map: map,
                        clickable: true,
                        position: coords
                    });

                    // 마커를 클릭했을 때 마커 위에 표시할 인포윈도우를 생성합니다
                    var iwContent = `<div style="padding:5px;"><a href="https://map.kakao.com/link/map/길찾기,${Y},${X}" target="+blank">길찾기</a></div>`, // 인포윈도우에 표출될 내용으로 HTML 문자열이나 document element가 가능합니다
                        iwRemoveable = true; // removeable 속성을 ture 로 설정하면 인포윈도우를 닫을 수 있는 x버튼이 표시됩니다

                    // 인포윈도우를 생성합니다
                    var infowindow = new kakao.maps.InfoWindow({
                        content : iwContent,
                        removable : iwRemoveable
                    });

                    // 마커에 클릭이벤트를 등록합니다
                    kakao.maps.event.addListener(marker, 'click', function() {
                        // 마커 위에 인포윈도우를 표시합니다
                        infowindow.open(map, marker);
                    });

                    // 지도의 중심을 결과값으로 받은 위치로 이동시킵니다
                    map.setCenter(coords);
                }
            });
        /*]]>*/
        </script>
    </div><br>

    <p class="d-flex justify-content-center text-center">❤ [[${post.recommend}]]</p><br><br>

    <p class="d-flex justify-content-center text-center">조회수 : [[${post.views}]]</p><br><br>

    <div class="d-flex justify-content-center">
        <button class="btn btn-primary me-2" th:onclick="|location.href='@{/post/{postId}/edit(postId=${post.id})}'|" type="button">수정</button>
    </div><br><br>
    <th:block th:if="${member.id != post.writer.id}">
        <div class="d-flex justify-content-end">
            <form method="POST" th:action="@{/chatroom/new}">
                <input type="hidden" name="postId" th:value=${post.id}>
                <button style="background: #3285ED; padding: 1vw 3vw; color: white;" class="btn chat-btn me-2" type="submit">문의하기</button>
            </form>
        </div>
    </th:block>
    <br><br>
</div>
<script>
    function createChatRoom(){
        postId : [[${post.id}]]
        data = {
            postId : [[${post.id}]]
        }
        $.ajax({
            url: "/chatroom/",
            type: "POST",
            data: data,
            success: function(result){
                console.log("리스폰스"+result)
                window.location.href="/chatroom/enter?roomId="+result.roomId;
            }
         })
    }
</script>
</html>